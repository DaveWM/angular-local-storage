/**
 * An Angular module that gives you access to the browsers local storage
 * @version v0.1.5 - 2014-11-27
 * @link https://github.com/grevory/angular-local-storage
 * @author grevory <greg@gregpike.ca>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b){"use strict";function c(a){return/^-?\d+\.?\d*$/.test(a.replace(/["']/g,""))}var d=b.isDefined,e=b.isUndefined,f=b.isNumber,g=b.isObject,h=b.isArray,i=b.extend,j=b.toJson,k=b.fromJson,l=b.module("LocalStorageModule",[]);l.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setStorageCookie=function(a,b){return this.cookie={expiry:a,path:b},this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse",function(a,l,m,n){var o,p=this,q=p.prefix,r=p.cookie,s=p.notify,t=p.storageType;m?m[0]&&(m=m[0]):m=document,"."!==q.substr(-1)&&(q=q?q+".":"");var u=function(a){return q+a},v=function(){try{var b=t in l&&null!==l[t],c=u("__"+Math.round(1e7*Math.random()));return b&&(o=l[t],o.setItem(c,""),o.removeItem(c)),b}catch(d){return t="cookie",a.$broadcast("LocalStorageModule.notification.error",d.message),!1}}(),w=function(b,c){if(e(c)?c=null:(g(c)||h(c)||f(+c||c))&&(c=j(c)),!v||"cookie"===p.storageType)return v||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),C(b,c);try{(g(c)||h(c))&&(c=j(c)),o&&o.setItem(u(b),c),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:p.storageType})}catch(d){return a.$broadcast("LocalStorageModule.notification.error",d.message),C(b,c)}return!0},x=function(b){if(!v||"cookie"===p.storageType)return v||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),D(b);var d=o?o.getItem(u(b)):null;return d&&"null"!==d?"{"===d.charAt(0)||"["===d.charAt(0)||c(d)?k(d):d:null},y=function(b){if(!v||"cookie"===p.storageType)return v||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:b,storageType:"cookie"}),E(b);try{o.removeItem(u(b)),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:b,storageType:p.storageType})}catch(c){return a.$broadcast("LocalStorageModule.notification.error",c.message),E(b)}return!0},z=function(){if(!v)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var b=q.length,c=[];for(var d in o)if(d.substr(0,b)===q)try{c.push(d.substr(b))}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.Description),[]}return c},A=function(b){b=b||"";var c=q.slice(0,-1),d=new RegExp(c+"."+b);if(!v||"cookie"===p.storageType)return v||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),F();var e=q.length;for(var f in o)if(d.test(f))try{y(f.substr(e))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.message),F()}return!0},B=function(){try{return l.navigator.cookieEnabled||"cookie"in m&&(m.cookie.length>0||(m.cookie="test").indexOf.call(m.cookie,"test")>-1)}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}}(),C=function(b,c){if(e(c))return!1;if((h(c)||g(c))&&(c=j(c)),!B)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var d="",f=new Date,i="";if(null===c?(f.setTime(f.getTime()+-864e5),d="; expires="+f.toGMTString(),c=""):0!==r.expiry&&(f.setTime(f.getTime()+24*r.expiry*60*60*1e3),d="; expires="+f.toGMTString()),b){var k="; path="+r.path;r.domain&&(i="; domain="+r.domain),m.cookie=u(b)+"="+encodeURIComponent(c)+d+k+i}}catch(l){return a.$broadcast("LocalStorageModule.notification.error",l.message),!1}return!0},D=function(b){if(!B)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=m.cookie&&m.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(u(b)+"=")){var f=decodeURIComponent(e.substring(q.length+b.length+1,e.length));try{var g=JSON.parse(f);return k(g)}catch(h){return f}}}return null},E=function(a){C(a,null)},F=function(){for(var a=null,b=q.length,c=m.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));E(e)}},G=function(){return t},H=function(a,c,e,f){f=f||c;var h=x(f);null===h&&d(e)?h=e:g(h)&&g(e)&&(h=i(e,h)),n(c).assign(a,h);var j=function(d){if(d.key==u(c)){var e=x(c);a[c]&&"object"==typeof a[c]?b.extend(a[c],e):a[c]=e,a.$apply()}};l.addEventListener("storage",j,!1);var k=a.$watch(c,function(a){w(f,a)},g(a[c]));return function(){k(),l.removeEventListener("storage",j)}},I=function(){for(var a=0,b=l[t],c=0;c<b.length;c++)0===b.key(c).indexOf(q)&&a++;return a};return{isSupported:v,getStorageType:G,set:w,add:w,get:x,keys:z,remove:y,clearAll:A,bind:H,deriveKey:u,length:I,cookie:{isSupported:B,set:C,add:C,get:D,remove:E,clearAll:F}}}]})}(window,window.angular);